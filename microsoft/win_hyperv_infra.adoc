---
sidebar: sidebar 
permalink: microsoft/win_hyperv_infra.html 
keywords: Windows,Hyper-V,VHDX,VM,Virtual 
summary: ONTAP을 사용한 Hyper-V 스토리지 인프라 
---
= NetApp 기반의 Hyper-V 스토리지 인프라
:allow-uri-read: 


[role="lead"]
Hyper-V 스토리지 인프라는 ONTAP 스토리지 시스템에서 호스팅될 수 있습니다. 다음 그림과 같이 Hyper-V용 스토리지는 NetApp LUN 또는 NetApp CIFS 공유를 사용하여 VM 파일과 해당 디스크를 저장할 수 있습니다.

image:win_image5.png["NetApp 기반의 Hyper-V 스토리지 인프라, 폭 = 624, 높이 = 338"]



== NetApp LUN의 Hyper-V 스토리지

* Hyper-V 서버 시스템에서 NetApp LUN을 프로비저닝합니다. 자세한 내용은"link:win_san.html["SAN 환경에서 프로비저닝"]있습니다."
* 서버 관리자의 도구 섹션에서 Hyper-V 관리자를 엽니다.
* Hyper-V 서버를 선택하고 Hyper-V 설정 을 클릭합니다.
* VM 및 해당 디스크를 LUN으로 저장할 기본 폴더를 지정합니다. 이렇게 하면 기본 경로가 Hyper-V 스토리지의 LUN으로 설정됩니다. VM에 대한 경로를 명시적으로 지정하려면 VM 생성 중에 지정할 수 있습니다.




== NetApp CIFS 공유의 Hyper-V 스토리지

이 섹션에 나열된 단계를 시작하기 전에"link:win_smb.html["SMB 환경에서의 프로비저닝"]." NetApp CIFS 공유에서 Hyper-V 스토리지를 구성하려면 다음 단계를 완료하십시오.

. 서버 관리자의 도구 섹션에서 Hyper-V 관리자를 엽니다.
. Hyper-V 서버를 선택하고 Hyper-V 설정 을 클릭합니다.
. VM 및 해당 디스크를 CIFS 공유로 저장할 기본 폴더를 지정합니다. 이렇게 하면 기본 경로가 Hyper-V 스토리지의 CIFS 공유로 설정됩니다. VM에 대한 경로를 명시적으로 지정하려면 VM 생성 중에 지정할 수 있습니다.


Hyper-V의 각 VM은 물리적 호스트에 제공된 NetApp LUN 및 CIFS 공유와 함께 제공될 수 있습니다. 이 절차는 모든 물리적 호스트와 동일합니다. VM에 스토리지를 프로비저닝하는 데 사용할 수 있는 방법은 다음과 같습니다.

* VM 내에서 FC 이니시에이터를 사용하여 스토리지 LUN을 추가합니다
* VM 내에서 iSCSI 이니시에이터를 사용하여 스토리지 LUN을 추가합니다
* VM에 패스스루 물리 디스크 추가
* 호스트에서 VM에 VHD/VHDX 추가




=== 모범 사례

* NetApp은 VM 및 해당 데이터가 NetApp 스토리지에 저장된 경우 NetApp 중복제거를 정기적으로 볼륨 레벨에서 실행하는 것이 좋습니다. 이 방법을 사용하면 동일한 VM이 CSV 또는 SMB 공유에서 호스팅될 때 공간을 크게 절약할 수 있습니다. 중복 제거는 스토리지 컨트롤러에서 실행되며 호스트 시스템과 VM 성능에 영향을 주지 않습니다.
* Hyper-V에 iSCSI LUN을 사용할 때는 을 사용하도록 설정해야 합니다 `iSCSI Service (TCP-In) for Inbound` 및 `iSCSI Service (TCP-Out) for Outbound` Hyper-V 호스트의 방화벽 설정에서 이렇게 하면 iSCSI 트래픽이 Hyper-V 호스트와 NetApp 컨트롤러로 전달될 수 있습니다.
* NetApp은 관리 운영 체제에서 Hyper-V 가상 스위치에 대해 이 네트워크 어댑터를 공유하도록 허용 옵션의 선택을 취소할 것을 권장합니다. 이렇게 하면 VM을 위한 전용 네트워크가 생성됩니다.




=== 기억해야 할 사항

* 가상 Fibre Channel을 사용하여 VM을 프로비저닝하려면 N_Port ID Virtualizationâ€"를 사용하는 FC HBA가 필요합니다. 최대 4개의 FC 포트가 지원됩니다.
* 호스트 시스템이 여러 FC 포트로 구성되어 있고 VM에 제공되는 경우 다중 경로를 활성화하려면 VM에 MPIO를 설치해야 합니다.
* 통과 디스크는 MPIO를 지원하지 않으므로 MPIO가 해당 호스트에서 사용되는 경우 패스스루 디스크를 호스트에 프로비저닝할 수 없습니다.
* VHD/VHDX 파일에 사용되는 디스크는 할당에 64K 형식을 사용해야 합니다.




=== 추가 참고 자료

* FC HBA에 대한 자세한 내용은 를 참조하십시오 http://mysupport.netapp.com/matrix/["NetApp 상호 운용성 매트릭스"].
* 가상 파이버 채널에 대한 자세한 내용은 Microsoft 를 참조하십시오 https://technet.microsoft.com/en-us/library/hh831413.aspx["Hyper-V 가상 파이버 채널 개요"] 페이지.




== 오프로드된 데이터 전송

복제 오프로드라고도 하는 Microsoft ODX는 호스트 컴퓨터를 통해 데이터를 전송하지 않고도 스토리지 디바이스 내에서 또는 호환되는 스토리지 디바이스 간에 데이터를 직접 전송할 수 있도록 합니다. NetApp ONTAP은 CIFS 및 SAN 프로토콜에 대해 ODX 기능을 지원합니다. ODX는 복제본이 동일한 볼륨 내에 있을 경우 성능이 향상될 수 있으며 클라이언트의 CPU 및 메모리 활용률을 줄이고 네트워크 I/O 대역폭 사용률을 줄일 수 있습니다.

ODX를 사용하면 SMB 공유 내에서, LUN 내에서, 그리고 동일한 볼륨에 있는 SMB 공유와 LUN 간에 파일을 빠르고 효율적으로 복사할 수 있습니다. 이 접근 방식은 OS(VHD/VHDX)의 중요 이미지의 여러 복사본이 동일한 볼륨 내에 필요한 경우에 더 유용합니다. 동일한 볼륨 내에 복제본이 있는 경우 동일한 골든 이미지의 여러 복사본을 훨씬 짧은 시간에 만들 수 있습니다. ODX는 VM 스토리지 이동을 위한 Hyper-V 스토리지 실시간 마이그레이션에도 적용됩니다.

여러 볼륨에 걸쳐 복제가 이루어지는 경우 호스트 기반 복제본에 비해 성능이 크게 향상되지 않을 수 있습니다.

CIFS에서 ODX 기능을 사용하도록 설정하려면 NetApp 스토리지 컨트롤러에서 다음 CLI 명령을 실행합니다.

. CIFS에 대해 ODX를 사용하도록 설정합니다.
# 권한 수준을 진단으로 설정합니다
클러스터:> set-privilege 진단
+
....
#enable the odx feature
cluster::> vserver cifs options modify -vserver <vserver_name> -copy-offload-enabled true
....
+
....
#return to admin privilege level
cluster::> set privilege admin
....
. SAN에서 ODX 기능을 사용하도록 설정하려면 NetApp 스토리지 컨트롤러에서 다음 CLI 명령을 실행합니다.
# 권한 수준을 진단으로 설정합니다
클러스터:> set-privilege 진단
+
....
#enable the odx feature
cluster::> copy-offload modify -vserver <vserver_name> -scsi enabled
....
+
....
#return to admin privilege level
cluster::> set privilege admin
....




=== 기억해야 할 사항

* CIFS의 경우 ODX는 클라이언트와 스토리지 서버가 SMB 3.0과 ODX 기능을 모두 지원하는 경우에만 사용할 수 있습니다.
* SAN 환경의 경우 ODX는 클라이언트와 스토리지 서버가 모두 ODX 기능을 지원하는 경우에만 사용할 수 있습니다.




=== 추가 참고 자료

ODX에 대한 자세한 내용은 를 참조하십시오 https://docs.netapp.com/us-en/ontap/smb-admin/improve-microsoft-remote-copy-performance-concept.html["Microsoft 원격 복사 성능 향상"] 및 https://docs.netapp.com/us-en/ontap/san-admin/microsoft-offloaded-data-transfer-odx-concept.html["Microsoft Offloaded Data Transfer(Microsoft 오프로드 데이터 전송)"] .



== Hyper-V 클러스터링: 가상 머신을 위한 고가용성 및 확장성

장애 조치 클러스터는 Hyper-V 서버에 높은 가용성과 확장성을 제공합니다. 장애 조치 클러스터는 VM의 가용성 및 확장성을 높이기 위해 함께 작동하는 독립 Hyper-V 서버 그룹입니다.

Hyper-V 클러스터 서버(노드라고 함)는 물리적 네트워크와 클러스터 소프트웨어에 의해 연결됩니다. 이러한 노드는 공유 스토리지를 사용하여 구성, VHD(가상 하드 디스크) 파일 및 스냅샷 복사본을 포함한 VM 파일을 저장합니다. 그림 6과 같이 공유 스토리지는 NetApp SMB/CIFS 공유 또는 NetApp LUN 위에 있는 CSV일 수 있습니다. 이 공유 스토리지는 클러스터의 모든 노드에서 동시에 액세스할 수 있는 일관되고 분산된 네임스페이스를 제공합니다. 따라서 클러스터에서 한 노드에 장애가 발생하면 다른 노드는 페일오버라는 프로세스를 통해 서비스를 제공합니다. 장애 조치 클러스터는 장애 조치 클러스터 관리자 스냅인과 장애 조치 클러스터링 Windows PowerShell cmdlet을 사용하여 관리할 수 있습니다.



=== 클러스터 공유 볼륨

CSV를 사용하면 페일오버 클러스터의 여러 노드에서 NTFS 또는 ReFS 볼륨으로 프로비저닝된 동일한 NetApp LUN에 대한 읽기/쓰기 액세스를 동시에 가질 수 있습니다. CSV를 사용하면 드라이브 소유권을 변경하거나 볼륨을 마운트 해제 및 다시 마운트하지 않고도 노드 간에 클러스터 역할이 빠르게 페일오버될 수 있습니다. 또한 CSV를 사용하면 페일오버 클러스터에서 잠재적으로 많은 수의 LUN을 간편하게 관리할 수 있습니다. CSV는 NTFS 또는 ReFS 위에 계층화된 범용 클러스터 파일 시스템을 제공합니다.

image:win_image6.png["Hyper-V 페일오버 클러스터 및 NetApp, 폭 = 624, 높이 = 271"]



=== 모범 사례

* NetApp는 내부 클러스터 통신 및 CSV 트래픽이 같은 네트워크를 통해 흐르지 않도록 iSCSI 네트워크에서 클러스터 통신을 끄는 것이 좋습니다.
* NetApp은 이중화 네트워크 경로(여러 스위치)를 생성하여 복원력 및 QoS를 제공하는 것이 좋습니다.




=== 기억해야 할 사항

* CSV에 사용되는 디스크는 NTFS 또는 ReFS로 분할되어야 합니다. FAT 또는 FAT32로 포맷된 디스크는 CSV에 사용할 수 없습니다.
* CSV에 사용되는 디스크는 할당에 64K 형식을 사용해야 합니다.




=== 추가 참고 자료

Hyper-V 클러스터 구축에 대한 자세한 내용은 부록 B: link:win_deploy_hyperv.html["Hyper-V 클러스터를 구축합니다"].



== Hyper-V 실시간 마이그레이션: VM 마이그레이션

VM을 Windows 클러스터의 다른 호스트로 이동하려면 VM의 수명 기간 동안 필요한 경우가 있습니다. 호스트에 시스템 리소스가 부족하거나 유지 보수를 위해 호스트를 재부팅해야 하는 경우 이 작업을 수행해야 할 수 있습니다. 마찬가지로 VM을 다른 LUN 또는 SMB 공유로 이동해야 할 수도 있습니다. 현재 LUN 또는 공유의 공간이 부족하거나 예상보다 성능이 낮은 경우 이 작업이 필요할 수 있습니다. Hyper-V 라이브 마이그레이션은 실행 중인 VM을 하나의 물리적 Hyper-V 서버에서 다른 서버로 이동하며, 사용자는 VM 가용성에 영향을 주지 않습니다. 장애 조치 클러스터의 일부인 Hyper-V 서버 간에 또는 클러스터에 속하지 않는 독립 Hyper-V 서버 간에 VM을 실시간 마이그레이션할 수 있습니다.



=== 클러스터 환경에서의 실시간 마이그레이션

VM은 클러스터의 노드 간에 원활하게 이동할 수 있습니다. 클러스터의 모든 노드가 동일한 스토리지를 공유하고 VM과 해당 디스크에 액세스할 수 있기 때문에 VM 마이그레이션은 즉각적입니다. 다음 그림에서는 클러스터 환경의 실시간 마이그레이션을 보여 줍니다.

image:win_image7.png["클러스터 환경에서 라이브 마이그레이션, 폭 = 580, 높이 = 295"]



=== 모범 사례

* 실시간 마이그레이션 트래픽을 위한 전용 포트가 있습니다.
* 마이그레이션 중에 네트워크 관련 문제를 방지하기 위해 전용 호스트 라이브 마이그레이션 네트워크를 사용합니다.




=== 추가 참고 자료

클러스터 환경에서 실시간 마이그레이션을 배포하는 방법에 대한 자세한 내용은 을 참조하십시오 link:win_deploy_hyperv_lmce.html["부록 C: 클러스터 환경에 Hyper-V 실시간 마이그레이션을 배포합니다"].



=== 클러스터 환경 외부의 라이브 마이그레이션

클러스터링되지 않은 독립 Hyper-V 서버 두 대 간에 VM을 실시간으로 마이그레이션할 수 있습니다. 이 프로세스에서는 공유 또는 공유 비공유 실시간 마이그레이션을 사용할 수 있습니다.

* 공유 실시간 마이그레이션에서는 VM이 SMB 공유에 저장됩니다. 따라서 VM을 라이브 마이그레이션할 때 다음 그림과 같이 VM의 스토리지는 중앙 SMB 공유로 유지되어 다른 노드가 즉시 액세스할 수 있습니다.


image:win_image8.png["클러스터링되지 않은 환경에서 공유된 라이브 마이그레이션, 너비 = 331, 높이 = 271"]

* 무공유 실시간 마이그레이션에서는 각 Hyper-V 서버에 고유한 로컬 스토리지(SMB 공유, LUN 또는 DAS)가 있고 VM의 스토리지는 Hyper-V 서버에 로컬입니다. VM이 라이브 마이그레이션되면 VM의 스토리지가 클라이언트 네트워크를 통해 대상 서버로 미러링되고 VM이 마이그레이션됩니다. 다음 그림과 같이 DAS, LUN 또는 SMB/CIFS 공유에 저장된 VM을 다른 Hyper-V 서버의 SMB/CIFS 공유로 이동할 수 있습니다. 두 번째 그림에 표시된 것처럼 LUN으로 이동할 수도 있습니다.


image:win_image9.png["클러스터링되지 않은 환경에서 SMB 공유로 무공유 실시간 마이그레이션, 폭 = 624, 높이 = 384"]

image:win_image10.png["클러스터링되지 않은 환경에서 LUN으로 무공유 실시간 마이그레이션, 너비 = 624, 높이 = 384"]



=== 추가 참고 자료

클러스터 환경 외부에 실시간 마이그레이션을 배포하는 방법에 대한 자세한 내용은 을 참조하십시오 link:win_deploy_hyperv_lmoce.html["부록 D: 클러스터 환경의 외부에 Hyper-V 실시간 마이그레이션을 배포합니다"].



=== Hyper-V 스토리지 실시간 마이그레이션

VM의 수명 기간 동안 VM 스토리지(VHD/VHDX)를 다른 LUN 또는 SMB 공유로 이동해야 할 수 있습니다. 현재 LUN 또는 공유의 공간이 부족하거나 예상보다 성능이 낮은 경우 이 작업이 필요할 수 있습니다.

LUN 또는 현재 VM을 호스팅하는 공유는 공간이 부족하거나 용도를 변경하거나 성능을 저하시킬 수 있습니다. 이러한 상황에서는 다운타임 없이 다른 LUN으로 VM을 이동하거나 다른 볼륨, 애그리게이트 또는 클러스터에서 공유할 수 있습니다. 스토리지 시스템에 복사본 오프로드 기능이 있는 경우 이 프로세스가 더 빠릅니다. NetApp 스토리지 시스템은 CIFS 및 SAN 환경에서 기본적으로 복사 오프로드가 지원됩니다.

ODX 기능은 원격 서버에 상주하는 두 디렉토리 간에 전체 파일 또는 하위 파일 복제를 수행합니다. 사본은 서버(또는 소스와 대상 파일이 모두 같은 서버에 있는 경우 동일한 서버) 간에 데이터를 복사하여 생성됩니다. 클라이언트가 소스에서 데이터를 읽거나 대상에 쓰지 않고 복제본이 생성됩니다. 이 프로세스는 클라이언트 또는 서버의 프로세서 및 메모리 사용을 줄이고 네트워크 I/O 대역폭을 최소화합니다. 동일한 볼륨 내에 있는 경우 복사 속도가 더 빠릅니다. 여러 볼륨에 걸쳐 복제가 이루어지는 경우 호스트 기반 복제본에 비해 성능이 크게 향상되지 않을 수 있습니다. 호스트에서 복제 작업을 진행하기 전에 복제 오프로드 설정이 스토리지 시스템에 구성되어 있는지 확인하십시오.

호스트에서 VM 스토리지 실시간 마이그레이션을 시작하면 소스와 대상이 식별되고 복제 작업이 스토리지 시스템으로 오프로드됩니다. 스토리지 시스템에서 작업을 수행하므로 호스트 CPU, 메모리 또는 네트워크를 거의 사용할 필요가 없습니다.

NetApp 스토리지 컨트롤러는 다음과 같은 다양한 ODX 시나리오를 지원합니다.

* * IntraSVM. * 데이터는 동일한 SVM에서 소유합니다.
* * Intravolume, intranode. * 소스 및 대상 파일 또는 LUN이 동일한 볼륨 내에 있습니다. 복사는 FlexClone 파일 기술을 사용하여 수행되므로 원격 복사 성능이 더욱 향상됩니다.
* * Intervolume, intranode. * 소스 및 대상 파일 또는 LUN이 동일한 노드에 있는 다른 볼륨에 있습니다.
* * Intervolume, Internodes. * 소스 및 대상 파일 또는 LUN이 서로 다른 노드에 있는 다른 볼륨에 있습니다.
* * InterSVM. * 데이터는 서로 다른 SVM에서 소유합니다.
* * Intervolume, intranode. * 소스 및 대상 파일 또는 LUN이 동일한 노드에 있는 다른 볼륨에 있습니다.
* * Intervolume, Internodes. * 소스 및 대상 파일 또는 LUN이 서로 다른 노드에 있는 다른 볼륨에 있습니다.
* * Intercluster. * ONTAP 9.0부터 SAN 환경의 클러스터 간 LUN 전송에 ODX도 지원됩니다. 인터클러스터 ODX는 SAN 프로토콜에만 지원되며 SMB에는 지원되지 않습니다.


마이그레이션이 완료된 후에는 VM을 보유한 새 볼륨을 반영하도록 백업 및 복제 정책을 다시 구성해야 합니다. 이전에 생성된 백업은 사용할 수 없습니다.

VM 스토리지(VHD/VHDX)는 다음 스토리지 유형 간에 마이그레이션할 수 있습니다.

* DAS 및 SMB 공유를 통해 이루어집니다
* DAS 및 LUN
* SMB 공유 및 LUN
* LUN 간 이동
* 두 가지 SMB 공유 기능


image:win_image11.png["Hyper-V 스토리지 실시간 마이그레이션, 폭 = 339, 높이 = 352"]



=== 추가 참고 자료

스토리지 실시간 마이그레이션 배포에 대한 자세한 내용은 을 참조하십시오 link:win_deploy_hyperv_slm.html["부록 E: Hyper-V 스토리지 실시간 마이그레이션 배포"].



== Hyper-V 복제본: 가상 시스템을 위한 재해 복구

Hyper-V 복제본은 Hyper-V VM을 기본 사이트에서 보조 사이트의 복제 VM으로 복제하여 비동기적으로 VM에 대한 재해 복구를 제공합니다. VM을 호스팅하는 기본 사이트의 Hyper-V 서버를 기본 서버라고 하며, 복제된 VM을 받는 보조 사이트의 Hyper-V 서버를 복제 서버라고 합니다. 다음 그림에는 Hyper-V 복제본 예제 시나리오가 나와 있습니다. 페일오버 클러스터의 일부인 Hyper-V 서버 간이나 클러스터에 속하지 않는 독립 Hyper-V 서버 간에 VM에 대해 Hyper-V 복제본을 사용할 수 있습니다.

image:win_image12.png["Hyper-V 복제본, 너비 = 624, 높이 = 201"]



=== 복제

기본 서버의 VM에 대해 Hyper-V 복제본을 설정한 후 초기 복제는 복제 서버에 동일한 VM을 생성합니다. 초기 복제 후 Hyper-V 복제본은 VM의 VHD에 대한 로그 파일을 유지합니다. 로그 파일은 복제 빈도에 따라 복제 VHD에 역순으로 재생됩니다. 이 로그와 역방향 순서를 사용하면 최신 변경 사항이 비동기적으로 저장되고 복제됩니다. 복제가 예상 빈도와 일치하지 않으면 알림이 발생합니다.



=== 확장 복제

Hyper-V 복제본은 재해 복구를 위해 보조 복제본 서버를 구성할 수 있는 확장된 복제를 지원합니다. 복제 서버에서 복제 VM의 변경 내용을 수신하도록 보조 복제 서버를 구성할 수 있습니다. 확장된 복제 시나리오에서는 기본 서버의 기본 VM에 대한 변경 사항이 복제 서버에 복제됩니다. 그런 다음 변경 내용이 확장 복제본 서버에 복제됩니다. 기본 및 복제 서버가 모두 다운된 경우에만 VM을 확장 복제 서버로 페일오버할 수 있습니다.



=== 페일오버

페일오버가 자동으로 수행되지 않으므로 프로세스를 수동으로 트리거해야 합니다. 장애 조치에는 세 가지 유형이 있습니다.

* * 테스트 대체 작동. * 이 유형은 복제 VM이 복제 서버에서 성공적으로 시작될 수 있고 복제 VM에서 시작되는지 확인하는 데 사용됩니다. 이 프로세스는 페일오버 중에 중복된 테스트 VM을 생성하며 일반 운영 복제에는 영향을 미치지 않습니다.
* * 계획된 장애 조치. * 이 유형은 계획된 가동 중단 시간 또는 예상되는 가동 중단 시간 중에 VM을 장애 조치하는 데 사용됩니다. 이 프로세스는 운영 VM에서 시작되며, 계획된 페일오버가 실행되기 전에 운영 서버에서 꺼져 있어야 합니다. 시스템이 페일오버된 후 Hyper-V 복제본은 복제본 서버에서 복제본 VM을 시작합니다.
* *예기치 않은 장애 조치.* 이 유형은 예기치 않은 중단이 발생할 때 사용됩니다. 이 프로세스는 복제본 VM에서 시작되며 기본 시스템에 장애가 발생한 경우에만 사용해야 합니다.




=== 복구

VM에 대한 복제를 구성할 때 복구 지점 수를 지정할 수 있습니다. 복구 지점은 복제된 컴퓨터에서 데이터를 복구할 수 있는 시점을 나타냅니다.



=== 추가 참고 자료

* 클러스터 환경 외부에 Hyper-V 복제본을 구축하는 방법에 대한 자세한 내용은 "link:win_deploy_hyperv_replica_oce.html["클러스터 환경 외부에 Hyper-V 복제본을 구축합니다"]있습니다."
* 클러스터 환경에서 Hyper-V 복제본을 구축하는 방법에 대한 자세한 내용은 "link:win_deploy_hyperv_replica_ce.html["클러스터 환경에 Hyper-V 복제본을 구축합니다"]있습니다."

